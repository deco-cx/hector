# Outputs Configuration

## Overview

The Outputs Configuration section allows users to define how the generated content from Actions will be presented to end users. It works similar to the Actions section, where users can select from various template types to structure their output.

## Template Types

Currently, the system supports one template type:

- **Story**: A template designed for narrative content with media support

In the future, additional template types may be added to support different use cases.

## Template Structure

### Story Template

The Story template has the following fields, all of which are optional:

- **backgroundImage**: An image file to serve as the background
- **title**: A text file containing the title of the story
- **content**: A text file containing the main content
- **audio**: An audio file for narration or soundtrack

All fields in templates reference files generated by previous actions using the `@filename.ext` notation (e.g., `@story.md`, `@cover.png`, `@narration.mp3`).

## Implementation Details

### JSON Schema Definition

- The JSON Schema for the Story template follows a similar pattern to the action schemas in `actionsConfig.ts`
- The schema includes property definitions and validations for each field
- The `title` property in the JSON schema is localized by language, similar to the "prompt" field in actions
- The title serves as the "default field" that's always rendered in the card view
- Other fields in the output templates always point to files and utilize the file selection dropdown

### File Type Detection

- Compatibility between files and field types is determined by file extensions
- For example:
  - Image fields (.png, .jpg, .jpeg, .gif, etc.) are compatible with backgroundImage
  - Text files (.md, .txt) are compatible with title and content
  - Audio files (.mp3, .wav) are compatible with audio

### State Management

- Output templates are stored as part of the main app state alongside actions and inputs
- This ensures a consistent state management approach throughout the application

## User Interface

### Template Selection

- The UI will display large buttons with descriptive icons for each available template type (currently only Story)
- Users click on a template button to add it to their outputs
- Once a template of a particular type has been added, the corresponding add button becomes disabled
- Users can only add one instance of each template type

### Template Configuration

- Templates are configured through a form interface (without the card flip effect used in Actions)
- Each field in the template provides a dropdown that shows only compatible files from the app's inputs and actions
- For example, the backgroundImage field only shows image files, while title/content fields only show text files
- Files are displayed with their `@filename.ext` notation to maintain consistency with the reference system

## Data Structure

The Outputs configuration is stored in the app's JSON structure under the `output` field as an array of template objects:

```json
{
  "output": [
    {
      "type": "Story",
      "title": {
        "EN": "My Story Title",
        "PT": "Título da Minha História"
      },
      "backgroundImage": "@cover.png",
      "content": "@story_content.md",
      "audio": "@narration.mp3"
    }
  ]
}
```

The Story type is defined in the application's types.ts file, and the JSON Schema in the configuration is derived from this type definition.

## File Selection Component

- The string input component in React JSON Schema Form is overridden for output fields
- The override transforms the input into a select dropdown that shows only available files of the appropriate type
- Files are categorized by their source (input fields vs. action outputs) and type (image, audio, text)
- The system provides appropriate first values in the select dropdown as a hint for the expected file type
- No strict validation is performed to block incompatible file types, but the dropdown helps guide users to select appropriate files

## Validation

- The system ensures that users can only select from files available in the app
- References to non-existent files are prevented through the dropdown selection interface
- When actions are removed, the system checks if any outputs reference files from those actions and flags them

## Future Development

### Rendering Logic
- The Story template will be rendered as an HTML page with the configured elements
- Implementation details for runtime rendering will be determined in the future

### Export Options
- Future versions may include options to export the rendered template (e.g., download as HTML, PDF)
- These features are not included in the initial implementation 